<!--views/pages/admin/docs.ejs-->
<!--views/pages/admin/docs.ejs-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>API Docs</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/swagger-ui-dist/swagger-ui.css"
    />

    <style>
      :root {
        --bg-dark: #0f172a;
        --bg-light: #ffffff;
      }

      body {
        margin: 0;
        font-family: system-ui, sans-serif;
      }

      /* ---------- Top Bar ---------- */
      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1.25rem;
        background: #0f172a;
        color: #e5e7eb;
      }

      .topbar a {
        color: #60a5fa;
        text-decoration: none;
        margin-right: 1rem;
        font-weight: 500;
      }

      /* ICON-ONLY THEME BUTTON */
      .topbar button {
        cursor: pointer;
        background: transparent;
        border: 1px solid #334155;
        color: inherit;
        border-radius: 6px;
        width: 36px;
        height: 36px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* ---------- Theme Background ---------- */
      body[data-theme="dark"] {
        background: var(--bg-dark);
      }

      body[data-theme="light"] {
        background: var(--bg-light);
      }

      /* -----------------------------
         Swagger Schemas ‚Äì Dark Mode Fix
      --------------------------------*/
      body[data-theme="dark"] .swagger-ui .model-container,
      body[data-theme="dark"] .swagger-ui .model-box,
      body[data-theme="dark"] .swagger-ui .model,
      body[data-theme="dark"] .swagger-ui .models,
      body[data-theme="dark"] .swagger-ui section.models {
        background-color: #020617 !important;
        border: 1px solid #1e293b !important;
      }

      body[data-theme="dark"] .swagger-ui .model-title,
      body[data-theme="dark"] .swagger-ui .model-title__text {
        color: #e5e7eb !important;
      }

      body[data-theme="dark"] .swagger-ui .model-toggle {
        background-color: #020617 !important;
      }

      body[data-theme="dark"] .swagger-ui .model-toggle::after {
        filter: invert(1);
      }

      body[data-theme="dark"] .swagger-ui .model-box-control {
        color: #93c5fd !important;
      }

      body[data-theme="dark"] .swagger-ui .model-container:hover {
        border-color: #38bdf8 !important;
      }

      /* Hide default Swagger topbar */
      .swagger-ui .topbar {
        display: none;
      }
    </style>
  </head>

  <body>
    <!-- MINI ADMIN BAR -->
    <div class="topbar">
      <div>
        <strong>Backend Admin</strong>
        <a href="/">üè†</a>
        <a href="/admin/playground">Playground</a>
        <a href="/admin/docs">Docs</a>
      </div>

      <!-- ICON ONLY -->
      <button
        onclick="toggleTheme()"
        title="Toggle theme"
        aria-label="Toggle theme"
      >
        üåó
      </button>
    </div>

    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>

    <script>
      /* -------------------------
         Unified Theme Handling
      ------------------------- */
      function syncTheme() {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");

        document.documentElement.setAttribute("data-theme", theme);
        document.body.setAttribute("data-theme", theme);
      }

      function toggleTheme() {
        const current =
          document.documentElement.getAttribute("data-theme") || "light";
        const next = current === "dark" ? "light" : "dark";

        localStorage.setItem("theme", next);
        document.documentElement.setAttribute("data-theme", next);
        document.body.setAttribute("data-theme", next);

        window.dispatchEvent(new Event("themechange"));
      }

      syncTheme();
      window.addEventListener("storage", syncTheme);
      window.addEventListener("themechange", syncTheme);

      /* -------------------------
         Swagger Init
      ------------------------- */
      SwaggerUIBundle({
        url: "/openapi.json",
        dom_id: "#swagger-ui",
        deepLinking: true,
        persistAuthorization: true,
      });

      /* -------------------------
         Auto-select Production Server
      ------------------------- */
      function selectProductionServer() {
        const interval = setInterval(() => {
          const select = document.querySelector(
            ".swagger-ui select[aria-label='Servers']"
          );

          if (!select) return;

          for (const option of select.options) {
            if (option.textContent.toLowerCase().includes("production")) {
              select.value = option.value;
              select.dispatchEvent(new Event("change"));
              clearInterval(interval);
              break;
            }
          }
        }, 100);
      }

      selectProductionServer();
    </script>
  </body>
</html>
