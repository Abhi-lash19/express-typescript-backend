<!--views/pages/admin/playground.ejs-->

<%- include("../../layout/base", {
  title: "API Playground",
  body: `
<hgroup>
  <h1>API Playground</h1>
  <p>Swagger-like API explorer for backend testing</p>
</hgroup>

<!-- =====================
     Generate JWT
     ===================== -->
<article>
  <h3>üîê Generate JWT (Required for Write APIs)</h3>

  <p class="muted">
    Generate a user-scoped JWT using email & password.
    This token will be automatically injected into requests.
  </p>

  <label>
    Email
    <input id="pg-email" type="email" placeholder="user@test.dev" />
  </label>

  <label>
    Password
    <input id="pg-password" type="password" placeholder="Strong password" />
  </label>

  <button id="generate-token">Generate Token</button>

  <p id="pg-auth-message" class="muted"></p>
</article>

<!-- Authorization -->
<article>
  <h3>Authorization</h3>

  <label>
    Auth Type
    <select id="authType">
      <option value="none">No Auth</option>
      <option value="bearer" selected>Bearer Token</option>
    </select>
  </label>

  <div id="bearer-panel">
    <label>
      Bearer Token
      <input
        id="token"
        placeholder="Paste Supabase JWT here"
        autocomplete="off"
      />
    </label>

    <small class="muted">
      GET requests may work without auth.
      POST / PUT / DELETE require a valid Supabase JWT.
    </small>
  </div>
</article>

<article>
  <h3>üìò Data Ownership Rules</h3>

  <ul class="muted">
    <li>Anyone can <strong>read</strong> all tasks</li>
    <li>Creating a task assigns ownership to your JWT</li>
    <li>You can only <strong>update or delete</strong> tasks you created</li>
    <li>Guessing another task ID will fail</li>
    <li>Enforced at both API and database (RLS) level</li>
  </ul>
</article>

<!-- Endpoints -->
<article>
  <h3>Endpoints</h3>
  <details open>
    <summary>Tasks API</summary>
    <ul id="endpoint-list" class="endpoint-list"></ul>
  </details>
</article>

<section class="grid">
  <!-- Request -->
  <article>
    <h3>Request</h3>

    <label>Method
      <input id="method" readonly />
    </label>

    <label>Endpoint
      <input id="endpoint" readonly />
    </label>

    <!-- Tabs -->
    <nav>
      <ul>
        <li><a href="#" data-tab="params">Params</a></li>
        <li><a href="#" data-tab="headers">Headers</a></li>
        <li><a href="#" data-tab="body">Body</a></li>
      </ul>
    </nav>

    <!-- Params -->
    <section data-panel="params">
      <h5>Path Params</h5>
      <div id="path-params"></div>

      <h5>Query Params</h5>
      <div id="query-params"></div>
    </section>

    <!-- Headers -->
    <section data-panel="headers" hidden>
      <p><strong>Authorization</strong> is auto-injected</p>
      <p><code>Content-Type</code> set automatically</p>
    </section>

    <!-- Body -->
    <section data-panel="body" hidden>
      <label>Body Type
        <select id="bodyType">
          <option value="none">None</option>
          <option value="json">JSON</option>
        </select>
      </label>

      <label>Request Body
        <textarea id="body" rows="8"></textarea>
      </label>

      <button id="beautify">Beautify JSON</button>
    </section>

    <footer>
      <button id="send">Send Request</button>
      <button class="outline" id="copyCurl">Copy as cURL</button>
    </footer>
  </article>

  <!-- Response -->
  <article id="response-panel">
    <h3>Response</h3>

    <ul>
      <li>Status: <strong id="status">‚Äî</strong></li>
      <li>Time: <strong id="time">‚Äî</strong> ms</li>
      <li>Rate Limit: <strong id="rate">‚Äî</strong></li>
    </ul>

    <details open>
      <summary>Response Schema</summary>
      <pre id="schema"></pre>
    </details>

    <pre><code id="response">{}</code></pre>
  </article>
</section>

<script src="/js/playground.js"></script>
`
}) %>
