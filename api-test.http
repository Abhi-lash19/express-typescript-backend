############################################
# Server: http://localhost:3000
# Purpose: Validate request validation, auth,
#          rate limiting, and safe defaults
############################################


############################################
# 1. LIST TASKS (NO QUERY)
# Expected: 200 OK
############################################
### List tasks
GET http://localhost:3000/tasks HTTP/1.1


############################################
# 2. SEARCH TASKS (INVALID QUERY)
# Reason: space-containing query fails validation
# Expected: 400 Bad Request
############################################
### Invalid search query
GET http://localhost:3000/tasks?search=abc Title HTTP/1.1


############################################
# 3. GET TASK BY INVALID ID
# Reason: id must be a number
# Expected: 400 Bad Request
############################################
### Invalid task ID
GET http://localhost:3000/tasks/abc HTTP/1.1


############################################
# 4. CREATE TASK (VALID JSON BODY)
# Expected: 201 Created
############################################
### Create task (valid JSON)
POST http://localhost:3000/tasks HTTP/1.1
Content-Type: application/json
x-api-key: mysecretkey

{
  "title": "Another task",
  "completed": false
}


############################################
# 5. CREATE TASK (INVALID BODY)
# Reason: title must be a string
# Expected: 400 Bad Request
############################################
### Create task with invalid title
POST http://localhost:3000/tasks HTTP/1.1
Content-Type: application/json
x-api-key: mysecretkey

{
  "title": 123,
  "completed": false
}


############################################
# 6. CREATE TASK WITH FORM DATA
# Behavior:
# - Passes if z.coerce.boolean() is enabled
# - Fails if strict boolean validation
############################################
### Create task with form-urlencoded data
POST http://localhost:3000/tasks HTTP/1.1
Content-Type: application/x-www-form-urlencoded
x-api-key: mysecretkey

title=Another+task&completed=false


############################################
# 7. UPDATE TASK WITHOUT AUTH
# Expected: 401 Unauthorized
############################################
### Update task without API key
PUT http://localhost:3000/tasks/2 HTTP/1.1
Content-Type: application/json

{
  "title": "Updated task title",
  "completed": true
}


############################################
# 8. UPDATE TASK WITH AUTH
# Expected: 200 OK
############################################
### Update task (authorized)
PUT http://localhost:3000/tasks/2 HTTP/1.1
Content-Type: application/json
x-api-key: mysecretkey

{
  "title": "Updated task title",
  "completed": true
}


############################################
# 9. RATE LIMIT TEST
# Action: Send this request >100 times quickly
# Expected: 429 Too Many Requests
############################################
### Rate limit test
GET http://localhost:3000/tasks HTTP/1.1


############################################
# 10. UNKNOWN ROUTE
# Expected: 404 Not Found
############################################
### Unknown route
GET http://localhost:3000/unknown-route HTTP/1.1

############################################
# 10. LIST TASKS VIA API V1
# Expected: 200 OK
############################################
GET http://localhost:3000/api/v1/tasks

####################################
# 11. CREATE TASK VIA API V1
# Expected: 201 Created
####################################
POST http://localhost:3000/api/v1/tasks